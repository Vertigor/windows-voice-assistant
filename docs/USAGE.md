# 使用指南

本文档介绍如何使用 Windows Voice Assistant 的各项功能。

## 启动应用

### 方式一：命令行启动

打开命令提示符或 PowerShell，进入项目目录，运行：

```bash
python -m voice_assistant
```

### 方式二：创建快捷方式

1. 右键点击桌面，选择"新建" -> "快捷方式"
2. 输入目标路径：
   ```
   C:\path\to\python.exe -m voice_assistant
   ```
3. 设置工作目录为项目根目录
4. 双击快捷方式即可启动

## 激活语音助手

应用启动后，有两种方式激活语音识别：

### 方式一：唤醒词

默认唤醒词是 **"小助手"**。只需对着麦克风说出唤醒词，应用就会开始监听您的指令。

**配置唤醒词**：
在配置文件中修改 `voice.wake_word` 字段。

### 方式二：快捷键

默认快捷键是 **Win+V**。按下快捷键后，应用会立即开始监听。

**配置快捷键**：
在配置文件中修改 `voice.hotkey` 字段。

## 邮件功能

### 查看邮件

**示例指令**：
- "查看今天的未读邮件"
- "看一下昨天的邮件"
- "有没有张三发来的邮件"
- "查看本周的邮件"

**支持的筛选条件**：
- **时间**: 今天、昨天、本周
- **发件人**: 按姓名或邮箱地址
- **状态**: 未读、已读

### 删除邮件

**示例指令**：
- "删除这封邮件"
- "删除刚才那封邮件"

**注意**: 删除操作需要先查看邮件，系统会记住最后一封查看的邮件。

### 标记邮件

**示例指令**：
- "标记为已读"
- "标记为未读"

## 文件功能

### 搜索文件

**示例指令**：
- "搜索名为'项目计划'的文件"
- "找一下电脑里的 Excel 文件"
- "查找下载文件夹里的 PDF"
- "搜索 30 天前的临时文件"

**支持的搜索条件**：
- **文件名**: 支持模糊匹配
- **文件类型**: pdf, docx, xlsx, jpg, png 等
- **位置**: 指定文件夹或全盘搜索
- **修改时间**: 按天数筛选

### 移动文件

**示例指令**：
- "把下载文件夹里的 PDF 移到文档库"
- "将这个文件移动到桌面"
- "把所有图片移到相册文件夹"

### 删除文件

**示例指令**：
- "删除这个文件"
- "删除桌面上的临时文件"

**安全机制**: 
- 删除操作需要二次确认
- 系统会提示 "确认要删除 XXX 吗？"
- 您需要回答 "确认删除" 才会执行

### 自动整理规则

**添加规则示例指令**：
- "设置下载的图片自动移到相册"
- "下载的安装包 7 天后自动删除"
- "所有 PDF 文件自动移到文档库"

**规则类型**：
- **移动规则**: 自动将特定类型的文件移到指定文件夹
- **删除规则**: 自动删除超过指定天数的文件

**查看和修改规则**：
规则保存在配置文件的 `file.rules` 字段中，可以手动编辑。

## 多轮对话

应用支持上下文关联，可以进行多轮对话：

**示例**：
1. 您: "查看今天的未读邮件"
2. 助手: "找到 3 封邮件，第一封的标题是..."
3. 您: "删除这封邮件"
4. 助手: "邮件已删除"
5. 您: "再看下一封"
6. 助手: "第二封邮件的标题是..."

## 系统托盘

应用运行时会在系统托盘显示图标。

### 托盘菜单

右键点击托盘图标，可以看到以下选项：

- **启动监听**: 开始语音监听
- **停止监听**: 停止语音监听
- **设置**: 打开配置文件
- **查看日志**: 打开日志文件夹
- **关于**: 显示应用信息
- **退出**: 退出应用

### 状态指示

托盘图标的提示文本会显示当前状态：
- "语音助手 - 空闲"
- "语音助手 - 监听中"
- "语音助手 - 处理中"

## 日志和调试

### 查看日志

日志文件位于：`%APPDATA%\VoiceAssistant\logs\`

每天会创建一个新的日志文件，文件名格式为 `voice_assistant_YYYYMMDD.log`。

### 日志级别

在配置文件中可以设置日志级别：

```json
{
  "general": {
    "log_level": "INFO"
  }
}
```

可选级别：DEBUG, INFO, WARNING, ERROR, CRITICAL

## 性能优化

### 模型选择

**Whisper 模型大小**：
- `tiny`: 最快，准确率较低
- `base`: 平衡（默认）
- `small`: 准确率高，速度较慢
- `medium`: 准确率很高，需要较好的硬件

在配置文件中修改：
```json
{
  "voice": {
    "stt_model": "base"
  }
}
```

### GPU 加速

如果您有 NVIDIA 显卡，可以安装 CUDA 版本的依赖以加速：

```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

## 常见问题

### Q: 语音识别不准确

**A**: 
1. 尝试更换更大的 Whisper 模型
2. 确保环境安静，麦克风质量良好
3. 说话清晰，语速适中

### Q: 意图理解错误

**A**: 
1. 使用更明确的指令
2. 查看日志了解识别的意图
3. 可以尝试使用更大的 LLM 模型

### Q: 邮件功能不工作

**A**: 
1. 检查邮箱配置是否正确
2. 确认网络连接正常
3. 查看日志文件获取详细错误

### Q: 文件搜索很慢

**A**: 
1. 限制搜索范围到特定文件夹
2. 安装 Everything 软件以加速搜索
3. 使用更具体的搜索条件

## 高级功能

### 自定义 Prompt

您可以修改 `voice_pipeline.py` 中的 `_build_intent_prompt` 方法来自定义意图理解的 Prompt，以适应您的特定需求。

### 扩展功能模块

应用采用模块化设计，您可以轻松添加新的功能模块：

1. 在 `voice_assistant/modules/` 下创建新模块
2. 在 `task_executor.py` 中注册新的意图处理器
3. 更新 Prompt 以支持新的意图类型

## 获取帮助

如果遇到问题，可以：

1. 查看日志文件
2. 阅读 [故障排除指南](TROUBLESHOOTING.md)
3. 在 GitHub 上提交 Issue
4. 查看项目 Wiki
